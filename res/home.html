<!DOCTYPE html>
<html>
<title>LaboHouse (alpha)</title>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript">
        /// Standard function used to display HTTP request errors.
        function show_error(res, status) {
            window.alert(status + ": " + res.getResponseHeader("error"));
        }

        function registerName() {
            $.ajax({
                type: 'POST',
                url: "/register",
                headers: {
                    'name': document.getElementById("name").value
                },

                success: function (data, status, req) {
                    var name = req.getResponseHeader("name");
                    document.getElementById("page::register").style.display = "none";
                    document.getElementById("page::main").style.display = "block";
                },
                error: function (res, error, status) {
                    show_error(res, status)
                }
            });
        }

        function queryUser() {
            $.ajax({
                type: 'POST',
                url: "/name",

                success: function (data, status, req) {
                    var name = req.getResponseHeader("name");
                    document.getElementById("page::register").style.display = "none";
                    document.getElementById("page::main").style.display = "block";
                },
                error: function (res, error, status) {
                    // Do nothing 
                }
            });
        }

        function registerHima() {
            $.ajax({
                type: 'POST',
                url: "/sethimado",
                headers: {
                    'Himado': document.getElementById("himado").value
                },

                success: function (data, status, req) {
                    window.location.href = "#list"
                    getHima();
                },
                error: function (res, error, status) {
                    show_error(res, status)
                }
            });
        }

        function getHima() {
            $.ajax({
                type: 'POST',
                url: '/gethimado',
                success: function (data, status, req) {
                    var himado = req.getResponseHeader("Himado");
                    window.alert(himado);
                },
                error: function (res, error, status) {
                    show_error(res, status)
                }
            });
        }

        window.onload = queryUser();
    </script>
    <style>
        .column {
            float: left;
            width: 50%;
        }

        .row:after {
            content: "";
            display: table;
            clear: both;
        }
    </style>
</head>

<body>
    <!-- Page Header -->
    <div id="header">
        <h1 style="text-align:center;">LaboHouse (alpha)</h1>
        <br>
    </div>

    <div id="page::register">
        <!-- Register Name -->
        <center>
            <form>
                <label for="api-url">Your name:</label>
                <input class="form-control" type="text" id="name" value="">
                <button type="button" onclick="registerName()" class="btn btn-primary rounded-pill">Send</button>
            </form>
        </center>
    </div>

    <div id="page::main" class="row" style="display: none;">
        <div id="panel::himado" class="column">
            <!-- ひま度の登録 -->
            <center>
                <h3 style="text-align:center;">Please set your Himado</h3>
                <select class="form-control" id="himado">
                    <option value="1">very hima</option>
                    <option value="2">hima</option>
                    <option value="3">not hima</option>
                </select>
                <button type="button" onclick="registerHima()" class="btn btn-primary rounded-pill">Register</button>
            </center>
        </div>

        <div id="panel::members" class="column">
            <center>
                <h3>Members</h3>
                <button type="button" onclick="getNames()" class="btn btn-primary rounded-pill">Refresh</button>
                <div id="list::members">
                </div>
            </center>
        </div>
</body>

</html>